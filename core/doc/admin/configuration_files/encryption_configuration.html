<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Encryption Configuration &mdash; ownCloud 8.0 Server Administration Manual 8.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/main.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="ownCloud 8.0 Server Administration Manual 8.0 documentation" href="../contents.html" />
    <link rel="up" title="File Sharing and Management" href="index.html" />
    <link rel="next" title="Configuring External Storage (GUI)" href="external_storage_configuration_gui.html" />
    <link rel="prev" title="Providing Default Files" href="default_files_configuration.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1d2d44">

  </head>
  <body role="document">


<div class="wrap container not-front">
  <div class="content row">
  <main class="main">
    <div class="row page-content-header">
      <div class="col-md-5 col-md-offset-7">
      
        <form class="headersearch" style="margin-bottom:-3px;" action="../search.html" method="get">
        <input type="text" value="" name="q" id="q" class="form-control" /> 
        <button  class="btn btn-default" type="submit" id="searchsubmit">Search</button>
        </form>
      
      </div>
    </div>
    
			<div class="row">
				<div class="col-md-3">
					<div class="sidebar">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>
										
<li><a href="../contents.html">Table of Contents</a></li>
									</ul>
                  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">ownCloud 8.0 Server Administration Manual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">ownCloud 8.0 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What&#8217;s New for Admins in ownCloud 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_user/index.html">User Management</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">File Sharing and Management</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="file_sharing_configuration.html">File Sharing</a></li>
<li class="toctree-l2"><a class="reference internal" href="big_file_upload_configuration.html">Uploading big files &gt; 512MB</a></li>
<li class="toctree-l2"><a class="reference internal" href="collaborative_documents_configuration.html">Configuring the Collaborative Documents App</a></li>
<li class="toctree-l2"><a class="reference internal" href="default_files_configuration.html">Providing Default Files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Encryption Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enabling-the-encryption-app">Enabling the Encryption App</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sharing-encrypted-files">Sharing Encrypted Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decrypting-encrypted-files">Decrypting Encrypted Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-a-file-recovery-key">Enabling a File Recovery Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-not-encrypted">Files Not Encrypted</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ldap-and-other-external-user-back-ends">LDAP and Other External User Back-ends</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encryption-migration-to-owncloud-8-0">Encryption migration to ownCloud 8.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="external_storage_configuration_gui.html">Configuring External Storage (GUI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_storage_configuration_gui.html#google-drive">Google Drive</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_storage_configuration.html">Configuring External Storage (Configuration File)</a></li>
<li class="toctree-l2"><a class="reference internal" href="files_locking_enabling.html">Using the Files Locking App</a></li>
<li class="toctree-l2"><a class="reference internal" href="federated_cloud_sharing_configuration.html">Configuring Federated Cloud Sharing</a></li>
<li class="toctree-l2"><a class="reference internal" href="previews_configuration.html">Previews Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="serving_static_files_configuration.html">Serving Static Files for Better Performance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_server/index.html">ownCloud Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_database/index.html">Database Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operations/index.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos/index.html">ownCloud Videos</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_installation/index.html">Enterprise Edition Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_clients/index.html">Creating Branded ownCloud Clients (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_server_branding/index.html">Enterprise Server Branding (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_external_storage/index.html">External Storage (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_user_management/index.html">User Management (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_files_drop/index.html">Enabling Anonymous Uploads with Files Drop (Enterprise Only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_logging/index.html">Enterprise Logging Apps (Enterprise only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_troubleshooting.html">Enterprise Troubleshooting</a></li>
</ul>

								</ul>
							</div>
					</div>
				</div>
        

				<div class="col-md-9">
					<div class="page-content">
            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="default_files_configuration.html" title="Previous Chapter: Providing Default Files"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Providing Def...</span>
    </a>
  </li>
  <li class="next">
    <a href="external_storage_configuration_gui.html" title="Next Chapter: Configuring External Storage (GUI)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Configuring E... &raquo;</span>
    </a>
  </li>
</ul>
						
  <div class="section" id="encryption-configuration">
<h1>Encryption Configuration<a class="headerlink" href="#encryption-configuration" title="Permalink to this headline">Â¶</a></h1>
<p>ownCloud includes a server-side encryption application. The Encryption app
encrypts all files stored on the ownCloud server, and all files on remote
storage that is connected to your ownCloud server. Encryption and decryption are
performed on the ownCloud server. All files sent to remote storage (for example
Dropbox and Google Drive) will be encrypted by the ownCloud server, and upon
retrieval, decrypted before serving them to you and anyone you have shared them
with.</p>
<p>Encrypting files increases their size by roughly 35%, so you must take this into
account when you are provisioning storage and setting storage quotas. User&#8217;s
quotas are based on the unencrypted file size, and not the encrypted file size.</p>
<p>When files on external storage are encrypted in ownCloud, you cannot share them
directly from the external storage services, but only through ownCloud sharing
because the key to decrypt the data never leaves the ownCloud server.</p>
<p>The main purpose of the Encryption app is to protect users&#8217; files on remote
storage, and to do it easily and seamlessly from within ownCloud.</p>
<p>The Encryption app generates a strong encryption key, which is unlocked by
user&#8217;s passwords. So your users don&#8217;t need to track an extra password, but
simply log in as they normally do.</p>
<p>Encryption is applied server-wide; it cannot be applied to selected users or
files.</p>
<p>The Encryption app encrypts only the contents of files, and not filenames and
folder structures.</p>
<p>You should regularly backup all encryption keys to prevent permanent data loss.
The encryption keys are stored in the following folders:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">data/owncloud_private_key</span></code></dt>
<dd>Recovery key, if enabled, and public share key</dd>
<dt><code class="docutils literal"><span class="pre">data/public-keys</span></code></dt>
<dd>Public keys for all users</dd>
<dt><code class="docutils literal"><span class="pre">data/&lt;user&gt;/files_encryption</span></code></dt>
<dd>Users&#8217; private keys and all other keys necessary to decrypt the users&#8217; files</dd>
<dt><code class="docutils literal"><span class="pre">data/files_encryption</span></code></dt>
<dd>private keys and all other keys necessary to decrypt the files stored on a
system wide external storage</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Encryption keys are stored only on the ownCloud server, eliminating
exposure of your data to third party storage providers. The encryption app
does <strong>not</strong> protect your data if your ownCloud server is compromised, and it
does not prevent ownCloud administrators from reading user&#8217;s files. This
would require client-side encryption, which this app does not provide. If
your ownCloud server is not connected to any external storage services then
it is better to  use other encryption tools, such as file-level or
whole-disk encryption. Read
<a class="reference external" href="https://owncloud.org/blog/how-owncloud-uses-encryption-to-protect-your-data/">How ownCloud uses encryption to protect your data</a>
for more information.</p>
</div>
<div class="section" id="enabling-the-encryption-app">
<h2>Enabling the Encryption App<a class="headerlink" href="#enabling-the-encryption-app" title="Permalink to this headline">Â¶</a></h2>
<p>The Encryption app is bundled with ownCloud, so first go to your Apps page to
enable it.</p>
<div class="figure">
<img alt="../_images/encryption1.png" src="../_images/encryption1.png" />
</div>
<p>After you click the <code class="docutils literal"><span class="pre">Enable</span></code> button you must log out, and then log back in.
If you continue to work without logging out, you&#8217;ll see a yellow banner at
the top of your Files page that warns you &#8220;Encryption App is enabled but your
keys are not initialized, please log-out and log-in again.&#8221;</p>
<div class="figure">
<img alt="../_images/encryption2.png" src="../_images/encryption2.png" />
</div>
<p>When you log out and then log back in, your encryption keys are initialized and
your files are encrypted. This is a one-time process, and it will take a few
minutes depending on how many files you have.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The more files you have, the longer the initial encryption will take. It is
better to activate the encryption app after a new ownCloud installation, to avoid
possible timeouts.</p>
</div>
<div class="figure">
<img alt="../_images/encryption3.png" src="../_images/encryption3.png" />
</div>
<p>When the encryption process is complete you&#8217;ll be returned to your default
ownCloud page. Every user will go through this process when they log in after
you enable encryption, and each user will get unique encryption keys. Users can change
their passwords whenever they want on their Personal pages, and ownCloud will update
their encryption keys automatically.</p>
</div>
<div class="section" id="sharing-encrypted-files">
<h2>Sharing Encrypted Files<a class="headerlink" href="#sharing-encrypted-files" title="Permalink to this headline">Â¶</a></h2>
<p>Only users who have private encryption keys have access to shared encrypted files and
folders. Users who have not yet created their private encryption keys will not have access
to encrypted shared files; they will see folders and filenames, but will not be able to
open or download the files. They will see a yellow warning banner that says &#8220;Encryption
App is enabled but your keys are not initialized, please log-out and log-in again.&#8221;</p>
<p>Share owners may need to re-share files after encryption is enabled; users trying to
access the share will see a message advising them to ask the share owner to re-share the
file with them. For individual shares, un-share and re-share the file. For group shares,
share with any individuals who can&#8217;t access the share. This updates the encryption, and
then the share owner can remove the individual shares.</p>
<div class="figure">
<img alt="../_images/encryption9.png" src="../_images/encryption9.png" />
</div>
</div>
<div class="section" id="decrypting-encrypted-files">
<h2>Decrypting Encrypted Files<a class="headerlink" href="#decrypting-encrypted-files" title="Permalink to this headline">Â¶</a></h2>
<p>You have the option of changing your mind and disabling the Encryption app.
Just click its Disable button on the Apps page, and when you go to your Files
page you&#8217;ll see the yellow banner warning &#8220;Encryption was disabled but your
files are still encrypted. Please go to your personal settings to decrypt your
files&#8221;.</p>
<div class="figure">
<img alt="../_images/encryption4.png" src="../_images/encryption4.png" />
</div>
<p>Go to your Personal page and enter your password in the Encryption removal form, and your
files will all be decrypted.</p>
<div class="figure">
<img alt="../_images/encryption5.png" src="../_images/encryption5.png" />
</div>
<p>Your users will also have to follow this step to decrypt their files. If
something goes wrong with decryption, click the <code class="docutils literal"><span class="pre">Restore</span> <span class="pre">Encryption</span> <span class="pre">Keys</span></code>
button to re-encrypt your files, and then review your logfile to see what
happened.</p>
</div>
<div class="section" id="enabling-a-file-recovery-key">
<h2>Enabling a File Recovery Key<a class="headerlink" href="#enabling-a-file-recovery-key" title="Permalink to this headline">Â¶</a></h2>
<p>If you lose your ownCloud password, then you lose access to your encrypted files. If one
of your users loses their ownCloud password their files are unrecoverable. You cannot
reset their password in the normal way; you&#8217;ll see a yellow banner warning &#8220;Please provide
an admin recovery password, otherwise all user data will be lost&#8221;.</p>
<p>To avoid all this, create a Recovery Key. Go to the Encryption section of your
Admin page and set a recovery key password.</p>
<div class="figure">
<img alt="../_images/encryption6.png" src="../_images/encryption6.png" />
</div>
<p>Then your users have the option of enabling password recovery on their Personal
pages. If they do not do this, then the Recovery Key won&#8217;t work for them.</p>
<div class="figure">
<img alt="../_images/encryption7.png" src="../_images/encryption7.png" />
</div>
<p>For users who have enabled password recovery, give them a new password and recover access
to their encrypted files by supplying the Recovery Key on the Users page.</p>
<div class="figure">
<img alt="../_images/encryption8.png" src="../_images/encryption8.png" />
</div>
</div>
<div class="section" id="files-not-encrypted">
<h2>Files Not Encrypted<a class="headerlink" href="#files-not-encrypted" title="Permalink to this headline">Â¶</a></h2>
<p>Only the data in your files is encrypted, and not the filenames or folder
structures. These files are never encrypted:</p>
<ul class="simple">
<li>Old files in the trash bin.</li>
<li>Image thumbnails from the Gallery app.</li>
<li>Previews from the Files app.</li>
<li>The search index from the full text search app.</li>
<li>Third-party app data</li>
</ul>
<p>There may be other files that are not encrypted; only files that are exposed to
third-party storage providers are guaranteed to be encrypted.</p>
</div>
<div class="section" id="ldap-and-other-external-user-back-ends">
<h2>LDAP and Other External User Back-ends<a class="headerlink" href="#ldap-and-other-external-user-back-ends" title="Permalink to this headline">Â¶</a></h2>
<p>If you use an external user back-end, such as an LDAP or Samba server, and you
change a user&#8217;s password on the back-end, the user will be prompted to change
their ownCloud login to match on their next ownCloud login. The user will need
both their old and new passwords to do this. If you have enabled the Recovery
Key then you can change a user&#8217;s password in the ownCloud Users panel to match
their back-end password, and then, of course, notify the user and give them
their new password.</p>
</div>
<div class="section" id="encryption-migration-to-owncloud-8-0">
<span id="upgrading-encryption-label"></span><h2>Encryption migration to ownCloud 8.0<a class="headerlink" href="#encryption-migration-to-owncloud-8-0" title="Permalink to this headline">Â¶</a></h2>
<p>When you upgrade from older versions of ownCloud to ownCloud 8.0, you must manually migrate
your encryption keys with the <em>occ</em> command after the upgrade is complete, like this
example for CentOS: <em>sudo -u apache php occ encryption:migrate-keys</em> You must run <em>occ</em> as
your HTTP user. See <a class="reference internal" href="../configuration_server/occ_command.html"><em>Using the occ Command</em></a> to learn more about <em>occ</em>.</p>
</div>
</div>


            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="default_files_configuration.html" title="Previous Chapter: Providing Default Files"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Providing Def...</span>
    </a>
  </li>
  <li class="next">
    <a href="external_storage_configuration_gui.html" title="Next Chapter: Configuring External Storage (GUI)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Configuring E... &raquo;</span>
    </a>
  </li>
</ul>
					</div>
				</div>
			</div>
  </main>  
  </div>
</div>
  </body>
</html>